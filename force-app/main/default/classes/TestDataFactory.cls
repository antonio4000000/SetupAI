/* 
 * Author:      Anthony Wheeler(wheeler.anthony96@gmail.com)
 * Created:     2023-08-07
 * Description: Generate Test Data for test classes
*/

@isTest
public with sharing class TestDataFactory {

    //Test system message generated by GPT-4
    public static String testSystemMessage = '1. Find the API name of the Chat object:- The API name of an object is usually the same as the object name, but with no spaces and in CamelCase. However, to confirm, you can run a SOQL query on the Tooling API.- Run this SOQL query on the Tooling API "SELECT Id, QualifiedAPIName FROM EntityDefinition WHERE MasterLabel = \'Chat\'"- If a result is returned, the QualifiedAPIName field will contain the API name of the Chat object.- If no result is returned, it\'s possible that the user is referring to the object by a different name. Ask the user for more information about the object, such as its fields or its purpose, to help identify it.';
   
    //Generate Chat__c record along with related Message__c records
    public static Chat__c createCompleteChat(){
        Chat__c newChat = getChat('Chat object API name request');
        insert newChat;
        insert getMessages(newChat.Id);
        return newChat;
    }

    //Generate single Chat__c record
    public static Chat__c getChat(String summary){
        return new Chat__c(
            Name = summary,
            Running__c = true
        );
    }

    //Generate messages to save to chat 
    public static Message__c[] getMessages(Id chatId){
        return new Message__c[]{
            getMessage(chatId, 'system', testSystemMessage, null, null),
            getMessage(chatId, 'user', 'What is the api name of the Chat object?', null, null),
            getMessage(chatId, 'assistant', null, 'soql', '{  "query": "SELECT Id, QualifiedAPIName FROM EntityDefinition WHERE MasterLabel = \'Chat\'"}'),
            getMessage(chatId, 'function', '[{"attributes":{"type":"EntityDefinition","url":"/services/data/v58.0/sobjects/EntityDefinition/01I03000000qaL6"},"Id":"000000000000000AAA","QualifiedApiName":"SetupAI__Chat__c","DurableId":"01I03000000qaL6"}]', 'soql', null),
            getMessage(chatId, 'assistant', 'The API name of the Chat object is "SetupAI__Chat__c".', null, null)
        };
    }

    //Generate Message__c record
    public static Message__c getMessage(Id chatId, String role, String content, String functionName, String functionArguments){
        return new Message__c(
            Thread__c = chatId,
            Role__c = role,
            Content__c = content,
            Function_Name__c = functionName,
            Function_Arguments__c = functionArguments
        );
    }

}